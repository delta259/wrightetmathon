<!-- -->
<!-- ..views/tabular*.php
<!-- set up the tabular style report
<!-- -->
<?php

	// get the number format -->
	$pieces	=	array();
	$pieces	= 	explode("/", $this->config->item('numberformat'));

	// ------------------------------------------------------------------
	// output to screen if required
	// ------------------------------------------------------------------

	// output the header
$this->load->view("partial/head");
	$this->load->view("partial/header_banner");
?>
<div id="wrapper" class="wlp-bighorn-book">
    <?php $this->load->view("partial/header_menu"); ?>
    <div class="wlp-bighorn-book">

        <div class="wlp-bighorn-book-content">

            <main id="login_page" class="wlp-bighorn-page-unconnect" role="main">

                <div class="body_page" >

                    <div class="body_colonne">
                        <h2 id="magasin"><?php echo $title; ?> </h2>

<div class="body_cadre_gris">
 
    <div> <?php

        include('../wrightetmathon/application/views/partial/show_messages.php');
        ?>
    </div>
	<!-- Output titles -->
<div id="title_bar">
<div class="span3">
        <input  value ="Imprimer" type="submit" style ="    float: right;" title="impression" class="btsubmit" OnClick="Printer.print(document.getElementById('sortable_table').innerHTML);"> </input>


    </div>
	<div id="page_title" class="float_left"></div>


<?php
switch($_SESSION['tabular_articles_yes'])
{
	case '1':
    ?>  
    <div id="page_subtitle" class="float_left"><h3><?php echo $subtitle . " ( " .$_SESSION['compteur']. " " .$this->lang->line('items_items') . ")" ; ?></h3></div>
	<?php
    break;
	default:
    ?>  
    <div id="page_subtitle" class="float_left"><h3><?php echo $subtitle; ?></h3></div>
	<?php
    break;	
}
?>	
	
	<?php
?>

</div>

	<!-- Output tables headers -->
	<div id="table_holder">
      <div style=" overflow-y:scroll; overflow-x:hidden;margin-top: 0px;    max-height: 600px;     min-height: 340px; width: 100%;border:#f5f5f5 1px solid;">
            <table style ="font-size: 16px;" width="100%" class="table table-striped table-bordered table-hover tablesorter" id="sortable_table">
		<!--<table class="tablesorter report" id="sortable_table">-->
			<thead>
				<tr><?php //if(isset($data[1]))
				//Condition pour empécher l'oeil de s'afficher sur n'importe quelle page qui utilise le fichier application/view/reports/tabular.php 
					if($_SESSION['oeil_desactivation']=='1')
					{
			?>		
				<th style="text-align:center;">	<?php echo "<strong>Désactiver</strong>" ?> </th>
	<?php		
	//unset($_SESSION['oeil_desactivation']);
    } 
	else 
	{
		//echo "<td></td>";	
	}
	
	//Pour faire un focus sur l'article où l'on a cliqué sur l'oeil
	if(isset($_SESSION['line_focus']))
	{
		$_SESSION['line']=$_SESSION['line_focus'];
	}
	?>
					<?php foreach ($headers as $header)
							{ ?>
                                <th><i class="fa fa-sort"><?php echo $header; ?></i></th>
							<?php } ?>
				</tr>
			</thead>

			<tbody>
				<!-- -->
				<!-- Select each row of the data array -->
				<!-- -->
				<?php foreach ($data as $line=>$row)
				{
				// colour the line I just processed.
				if ($_SESSION['line'] == $line)
				{
					$first_cell = 0;
				?>
					<tr id="line_couleur" >

				<?php
				}
				else
				{
				?>
					<tr >
				<?php
				}
				?>
					<!-- -->
					<!-- Now select each cell of the data row -->
					<!-- -->
					
					<?php /*
					//Récupération de la valeur du delete pour savoir comment afficher l'oeil (oeil barré ou oeil ouvert) (de la même manière que dans la fonction desactive)
                    $redirect = 'reports/inventory_rolling';
                  	$conn_parms = array();

	                //initialisation des parametres pour la connexion
	                $conn_parms = $this->Common_routines->get_conn_parms($redirect);
	                $conn =	$this->Common_routines->open_db($conn_parms);

					//Requête SQL
					//Récupération de $item_id
					$tableau_recuperation_item_id=array();
					$tableau_recuperation_item_id=explode("/",$row[1]);
					$cur_item_info->item_id=$tableau_recuperation_item_id[7];
	                $sql_for_deleted = "SELECT `deleted` FROM `ospos_items` WHERE `item_id` = '".$cur_item_info->item_id."'";						
					$result_for_deleted	= $conn->query($sql_for_deleted);	                
					$sql_for_quantity = "SELECT `quantity` FROM `ospos_items` WHERE `item_id` = '".$cur_item_info->item_id."'";						
					$result_for_quantity	= $conn->query($sql_for_quantity);
					
	                //récuperation de la ligne
					$request_for_deleted	=	$result_for_deleted->fetch_assoc();
					$request_for_quantity	=	$result_for_quantity->fetch_assoc();//*/

					$tableau_recuperation_item_id=array();
					$tableau_recuperation_item_id=explode("/",$row[1]);
					$cur_item_info->item_id=$tableau_recuperation_item_id[7];
					$data_item = $this->Item->get_info($cur_item_info->item_id);
					$request_for_deleted['deleted'] = $data_item->deleted;
					$request_for_quantity['quantity'] = $data_item->quantity;
					
					?>
					<?php
					//Récupération de $item_id et de $line
					$tableau_recuperation_item_id=array();
					$tableau_recuperation_item_id=explode("/",$row[1]);
					$cur_item_info->item_id=$tableau_recuperation_item_id[7];
				    $tout=(string)$cur_item_info->item_id . ':' . (string)$line . ":" . 'reports';
					?>	<?php //if(isset($cur_item_info->item_id))
				if($_SESSION['oeil_desactivation']=='1')
				{
					if($request_for_quantity['quantity']<=0)
					{
					    if($request_for_deleted['deleted']=='1')
					    {
			            ?>	
                           <td style="text-align:center;"><a href="<?php echo site_url("receivings/desactive/$tout"); ?>"><img src="<?php echo base_url().$_SESSION['url_image'].'/reactive.png';?>" width="21px" height="14px" alt="reactive" title='Désactiver'></a></td>
				        <?php
			            }
			            else
			            {
			            ?>
				           <td style="text-align:center;"><a href="<?php echo site_url("receivings/desactive/$tout"); ?>"><img src="<?php echo base_url().$_SESSION['url_image'].'/desactive.png';?>" width="21px" height="14px" alt="Desactive" title='Activer'></a></td>		
                        <?php
                        }		
                    } 
	                else
	                {
                        echo "<td></td>";
					}
				}
				else
				{
					//echo "<td></td>"; //Rien ne doit etre affiché
				}
	?>

					<?php foreach ($row as $cell)
						{ ?>
								<!-- -->
								<!-- Output each cell, format the number if numeric-->
								<!-- -->


								<?php
									if (is_numeric($cell))
									{
										//$cell = number_format($cell, $pieces[0], $pieces[1], $pieces[2]);
										if(is_int($cell))
										{
											$cell = intval($cell);
										}
										if(is_float($cell))
										{
											$cell = number_format($cell, $pieces[0], $pieces[1], $pieces[2]);
											$cell = floatval($cell);
										}
										?>
										<td align="right">
										<?php
									}
									else
									{
										?>
										<td align="left">
										<?php
									}

									// make first cell button in order to position cursor to line selected
									//if ($_SESSION['line'] == $line and $first_cell == 0)
									if ($_SESSION['autofocus_avec_item_id_tabular']==$cell)
									{
										$first_cell = 1;
											echo $cell;
											echo form_button(array(
												'autofocus'	=>	'autofocus',
												//'content' 	=> "",
												'type' => 'hidden'

												
												));

									}
									else
									{
										echo $cell;
									} ?>

							</td>
						<!-- -->
						<!-- Get next cell -->
						<!-- -->
						<?php } ?>
				</tr>
				<!-- -->
				<!-- Get next row -->
				<!-- -->
				<?php } ?>
			</tbody>
		</table>
      </div>

			<script type="text/javascript">

					var Printer= new Object();
					Printer.print=function (HTML) {
							var win = window.open(location,null,null);
							win.blur();
							window.focus();
                            magasin=document.getElementById('magasin').innerHTML;
							title=document.getElementById('page_subtitle').innerHTML;
                            resume=document.getElementById('report_summary').innerHTML;
                            win.document.title="Aperçu de l'impression en cours";
                            win.document.write("<html><head><title>"+document.title+"</title></head><body><h2>"+magasin+"</h2><h3>"+title+"</h3><table border=2 width='100%' class='printtable' style='font-size:11.5px; border-collapse:collapse;'>" + HTML +"</table><br/><br/>"+resume+"</body></html>");
                            win.print();
							win.close();
					};
					window.top.Printer=Printer;

			</script>
	</div>
	<div id="report_summary">
	<?php foreach($summary_data as $name=>$value) { ?>
		<div class="summary_row"><?php echo $this->lang->line('reports_'.$name). ': '.number_format($value, 2); ?></div>
	<?php } ?>
	</div>

</div>

</div>
                </div></main></div></div></div>
</div>


<script>
    $(document).ready(function()
        {
            $("#sortable_table").tablesorter();
        }
    );
</script>


<?php
unset($_SESSION['oeil_desactivation']);
unset($_SESSION['reactivation']);
unset($_SESSION['tabular_articles_yes']);

//unset($_SESSION['line_focus']);

// 	Output the footer
$this->load->view("partial/footer");
?>

<!-- Table sorter -->
<!--
<script type="text/javascript" language="javascript">
function init_table_sorting()
{
    //Only init if there is more than one row
    if($('.tablesorter tbody tr').length >1)
    {
        $("#sortable_table").tablesorter();
    }
}
$(document).ready(function()
{
    init_table_sorting();
});
</script>-->


