

<?php $this->load->view("partial/header_popup"); ?>
<dialog open class="fenetre modale cadre" style="width:1200px;">

  <!--HEADER-->
  <div class="fenetre-header">
    <span id="page_title" class="fenetre-title">
      <?php echo $_SESSION['$title']; /*$this->lang->line('modules_'.$_SESSION['controller_name']).' '*/?>
    </span>

    <?php
    include('../wrightetmathon/application/views/partial/show_exit.php');
    ?>


  </div>


  <!---CONTENT-->
  <div class="fenetre-content">
    <div class="centrepage">


      <?php
      // show data entry but not if item is already deleted
      if ($_SESSION['del'] == NULL)
      {
        ?>


        <?php
        // show delete button - only if item exists already
        if ($_SESSION['new'] != 1)
        {
          ?>



          <div class="txt_milieu">
            <div class="btnp">
              <a href="<?php echo site_url("items/view_pricelists");?>" class="" style="width: 180px; margin:0; height:38px; text-align: left;"><img style="margin-left: 5px;
                margin-bottom: -15px;
                "  width="35px" height ="35px" src="images/prix.png"> <?php echo $this->lang->line('pricelists_pricelist') ;?> </a>
                <a href="<?php echo site_url("items/view_suppliers");?>" style="width: 180px; margin:0; height:38px; text-align: left;" class=""><img style="margin-left: 5px;
                  margin-bottom: -15px;
                  "  width="35px" height ="35px" src="images/fournisseur.png"> <?php echo $this->lang->line('items_supplier') ;?> </a>
                  <a href="<?php echo site_url("items/view_warehouses");?>" style="width: 180px; margin:0; height:38px; text-align: left;" disabled="disabled"><img style="margin-left: 5px;
                    margin-bottom: -15px;
                    "  width="35px" height ="35px" src="images/entrepot.png"> <?php echo $this->lang->line('warehouses_warehouse') ;?> </a>
                  </div>
                </div>
                <!-- show next actions link -->
                <?php
                // pricelist
                /* echo anchor(   'items/view_pricelists',
                '=> '.$this->lang->line('pricelists_pricelist'),
                array('class'  => 'undelete_button float_right'));
                // suppliers
                echo anchor(   'items/view_suppliers',
                '=> '.$this->lang->line('items_supplier'),
                array('class'  => 'undelete_button float_right'));
                // warehouses
                echo anchor(   'items/view_warehouses',
                '=> '.$this->lang->line('warehouses_warehouse'),
                array('class'  => 'undelete_button float_right'));*/
                // kits
                if ($_SESSION['transaction_info']->DynamicKit == 'Y')
                {
                  echo anchor('items/kit/'.$_SESSION['transaction_info']->item_id,
                  ' '.$this->lang->line('common_manage').$this->lang->line('common_space').$this->lang->line('items_kit'),
                  array('class'  => 'undelete_button float_right'));
                }

                ?>


                <?php
              }
              ?>



              <?php
            }
            ?>
            <div class="blocformfond creationimmediate">
              <?php
              include('../wrightetmathon/application/views/partial/show_messages.php');
              ?>
              <?php
              // show data entry but not if item is already deleted
              if ($_SESSION['del'] == NULL)
              {
                ?>


                <?php
                // show delete button - only if item exists already
                if ($_SESSION['new'] != 1)
                {
                  ?>


                  <?php
                  // show delete button and barcode button - only if item not undeleting
                  if ($_SESSION['undel'] != 1)
                  {

                    echo '<div class="txt_droite">';

                    echo form_open       (
                      'items/generate_barcode/'.$_SESSION['transaction_info']->item_id,
                      array('id'=>'item_barcode_form')
                    );

                    echo form_submit      (  array  (
                      'name' => 'barcode',
                      'id'   => 'barcode',
                      'value'    => $this->lang->line('items_generate_barcodes'),
                      'class'    => 'btmodification '
                    )
                  );
                  echo form_close();


                  echo form_open       (
                    'items/delete/',
                    array('id'=>'item_delete_form')
                  );

                  echo form_submit      (  array  (
                    'name' => 'delete',
                    'id'   => 'delete',
                    'value'    => $this->lang->line('items_delete'),
                    'class'    => 'btmodification '
                  )
                );
                echo form_close();


                echo '</div>';

              }
              ?>

              <?php
              // show undel button - only if undeleting
              if ($_SESSION['undel'] == 1)
              {

                echo form_open       (
                  'items/undelete/',
                  array('id'=>'item_undelete_form')
                );

                echo form_submit      (  array  (
                  'name' => 'undelete',
                  'id'   => 'undelete',
                  'value'    => $this->lang->line('items_undelete'),
                  'class'    => 'btmodification txt_gauche'
                )
              );
              echo form_close();
            }
            ?>


            <?php
          }
          ?>



          <?php
        }
        ?>
        <?php
        // show enter button - only if item not undeleting
        if ($_SESSION['undel'] == NULL)
        {

          // when clicked use the controller, items, selecting method save and passing it the item ID.
          echo form_open($_SESSION['controller_name'].'/save/'.$_SESSION['transaction_info']->item_id.'/'.$_SESSION['origin'], array('id'=>'item_form'));
          ?>
          <fieldset>
            <table class="table_center" width="100%" style="/*border-spacing: 5px; border-collapse: separate;*/">
              <tbody>

                <tr>
                  <td colspan="3">
                    <table class="table_left" width="100%" style="/*border-spacing: 5px; border-collapse: separate;*/">


                      <tr>
                        <td align="" class="zone_champ_saisie"><?php echo form_input(array (
                          'name'    => 'item_number',
                          'id'      => 'item_number',
                          'style'       => 'font-size:16px;',
                          'class'=> 'colorobligatoire',
                          'placeholder'=> $this->lang->line('items_item_number'),
                          'value'       => $_SESSION['transaction_info']->item_number
                        ));?>
                        <a class="btaide" id="" title="<?php echo $this->lang->line('items_item_number');?>"></a>
                      </td>
                      <td align="" class="zone_champ_saisie"><?php echo form_input(array (
                        'name'    => 'name',
                        'id'      => 'name',
                        'style'       => 'font-size:16px;',
                        'size'    => 45,
                        'class'=> 'colorobligatoire',
                        'placeholder'=> $this->lang->line('items_name'),
                        'value'       => $_SESSION['transaction_info']->name
                      ));?>
                      <a class="btaide" id="" title="<?php echo $this->lang->line('items_name');?>"></a>
                    </td>

                  </tr>
                </table>
              </td>

              <td rowspan="6">
                <table class="" style="      border: solid 2px #000000;
               /* padding: 10px;*/
                margin-top: 15px;
                margin-bottom: 15px;
              /*  text-align: left;*/

                border-spacing: 5px;
                border-collapse: separate;">
                <tr><td>
                  <?php
                  // get userdata data
                  //    $values					=	array();
                  //    $values					=	$this->session->all_userdata();
                  //  $image_path				=	base_url().'barcodes/'.$values['item_number'].'.jpeg';
                  $image_path = '';
                  // messages
                  /*  if($values['success_or_failure'] == 'S')
                  {
                  echo "<div class='success_message'>".$values['message']."</div>";
                }


                if($values['success_or_failure'] == 'F')
                {
                echo "<div class='error_message'>".$values['message']."</div>";
              }//*/
              switch($_SESSION['show_image'])
              {
                case 'N':
                    //Ne rien faire, pour ne pas ralentir le débit internet
                break;        
              
                default:
                    //Récupération du lien de l'image dans la base de donnée
                    $redirect = 'items';
                		$conn_parms														=	array();
      
                		//initialisation des parametres pour la connexion
                		$conn_parms														=	$this->Common_routines->get_conn_parms($redirect);
                		$conn															=	$this->Common_routines->open_db($conn_parms);
                    $item_id=$_SESSION['transaction_info']->item_id;
                    //Requête SQL
                		$sql_image =	"SELECT `image_file_name` FROM `ospos_items` WHERE `item_id` = '". $item_id ."';";						
                		$result_image	=	$conn->query($sql_image);
                		
                		//récuperation de la ligne
                    $request_image	=	$result_image->fetch_assoc();
                break; 
              }
              if(!isset($request_image['image_file_name']))
              { //si l'image est non trouvée
                $request_image['image_file_name']=base_url().'SLIDES_VENTES/cadre.png';
              }
              else
              { //sinon, afficher l'image du produit correspondant
                $request_image['image_file_name']= "http://" . $request_image['image_file_name'];
              }
              ?>

<!--                      <img src="<?php echo base_url().'SLIDES_VENTES/cadre.png'; /*echo $image_path; */?>" alt="<?php echo $image_path; ?>" style="width:250px;height:250px">
<!--  -->                 <img src="<?php echo $request_image['image_file_name']; /*echo $image_path; */?>" alt="<?php echo $image_path; ?>" style="height:250px">
            </td></tr>
          </table>

        </td>


      </tr>

      <tr>
        <td >
          <table class="table_left" style="/*border-spacing: 5px; border-collapse: separate;*/">


            <tr>
              <td align="center" style="font-size:16px;"><?php echo form_label($this->lang->line('items_category'), 'category_id',array('class'=>'required wide')); ?></td>

              <td><?php echo form_dropdown   (
                'category_id',
                $_SESSION['category_pick_list'],
                $_SESSION['selected_category'],
                'style="font-size:18px" class="colorobligatoire"'
              );?>
              <a class="btaide" id="" title="<?php echo $this->lang->line('items_category');?>"></a>
            </td>




            <td align="" class="zone_champ_saisie" style="font-size:16px;"><?php echo form_input(array (
              'name'    => 'volume',
              'id'      => 'volume',
              'style'       => 'text-align:right; font-size:16px;',
              'size'    => 2,
              'class'=> 'colorobligatoire',
              'placeholder'=> $this->lang->line('items_volume'),
              'value'       => $_SESSION['transaction_info']->volume
            )); echo 'Ml';?>
            <a class="btaide" id="" title="<?php echo $this->lang->line('items_volume');?>"></a>
          </td>
          <td align="" style="font-size:16px;" class="zone_champ_saisie"><?php echo form_input(array (
            'name'    => 'nicotine',
            'id'      => 'nicotine',
            'style'       => 'text-align:right; font-size:16px;',
            'size'    => 2,
            'class'=> 'colorobligatoire',
            'placeholder'=> $this->lang->line('items_nicotine'),
            'value'       => $_SESSION['transaction_info']->nicotine
          )); echo 'Mg/Ml';?>
          <a class="btaide" id="" title="<?php echo $this->lang->line('items_nicotine');?>"></a>
        </td>


        <td >
          <table class="txt_gauche" style="border-spacing: 5px; border-collapse: separate;">


            <tr>
              <td align="right" class="zone_champ_saisie"><?php echo form_input(array (
                'name'    => 'image_file_name',
                'id'      => 'image_file_name',
                'style'       => 'text-align:right; font-size:16px;',
                'size'    => 20,
                'placeholder'=> $this->lang->line('items_image_file_name'),
                'value'       => $_SESSION['transaction_info']->image_file_name
              ));?>
              <a class="btaide" id="" title="<?php echo $this->lang->line('items_image_file_name');?>"></a>
            </td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
</td>
</tr>

<tr><td colspan="2">
  <table class="" style="border-spacing: 5px; border-collapse: separate;">


    <tr>
      <td align="center" style="font-size:16px;"><?php echo form_label($this->lang->line('items_dluo_indicator').$this->lang->line('common_question'), 'dluo_indicator', array('class'=>'required wide')); ?></td>

      <td align="center" class="zone_champ_saisie"><?php echo form_dropdown    (
        'dluo_indicator',
        $_SESSION['G']->YorN_pick_list,
        $_SESSION['selected_dluo_indicator'],
        'style="font-size:16px" class="colorobligatoire"'
      );?>
      <a class="btaide" id="" title="<?php echo $this->lang->line('items_dluo_indicator');?>"></a>
    </td>
    <td align="center" style="font-size:16px;"><?php echo form_label($this->lang->line('items_giftcard_indicator').$this->lang->line('common_question'), 'giftcard_indicator', array('class'=>'required wide')); ?></td>

    <td align="center" class="zone_champ_saisie"><?php echo form_dropdown    (
      'giftcard_indicator',
      $_SESSION['G']->YorN_pick_list,
      $_SESSION['selected_giftcard_indicator'],
      'style="font-size:16px" class="colorobligatoire"'
    );?>
    <a class="btaide" id="" title="<?php echo $this->lang->line('items_giftcard_indicator');?>"></a>
  </td>
  <td align="center" style="font-size:16px;"><?php echo form_label($this->lang->line('items_offer_indicator').$this->lang->line('common_question'), 'offer_indicator', array('class'=>'required wide')); ?></td>

  <td align="center" class="zone_champ_saisie"><?php echo form_dropdown    (
    'offer_indicator',
    $_SESSION['G']->YorN_pick_list,
    $_SESSION['selected_offer_indicator'],
    'style="font-size:16px" class="colorobligatoire"'
  );?>
  <a class="btaide" id="" title="<?php echo $this->lang->line('items_offer_indicator');?>"></a>
</td>
</tr>
</table>
</td></tr>

<tr>
  <td colspan="2">
    <table class="" style="/*border-spacing: 5px; border-collapse: separate;*/">
      <tr> <!--<td colspan="3" align="center"><?php echo $this->lang->line('items_export');?></td>
        <td align="center"><?php echo nbs(1); ?></td>-->
      </tr>

      <tr>
        <td style="font-size:16px;"><?php echo $this->lang->line('items_export').'?';?></td>
        <td align="center" style="font-size:16px;"><?php echo form_label($this->lang->line('items_export_to_franchise'), 'export_f',array('class'=>'required wide')); ?></td>

        <td align="center" class="zone_champ_saisie"><?php echo form_dropdown    (
          'export_to_franchise',
          $_SESSION['G']->YorN_pick_list,
          $_SESSION['selected_export_to_franchise'],
          'style="font-size:16px" class="colorobligatoire"'
        );?>
        <a class="btaide" id="" title="<?php echo $this->lang->line('items_export_to_franchise');?>"></a>
      </td>
      <td align="center" style="font-size:16px;"><?php echo form_label($this->lang->line('items_export_to_integrated'), 'export_i',array('class'=>'required wide')); ?></td>

      <td align="center" class="zone_champ_saisie"><?php echo form_dropdown    (
        'export_to_integrated',
        $_SESSION['G']->YorN_pick_list,
        $_SESSION['selected_export_to_integrated'],
        'style="font-size:16px" class="colorobligatoire"'
      );?>
      <a class="btaide" id="" title="<?php echo $this->lang->line('items_export_to_integrated');?>"></a>
    </td>
    <td align="center" style="font-size:16px;"><?php echo form_label($this->lang->line('items_export_to_other'), 'export_o',array('class'=>'required wide')); ?></td>

    <td align="center" class="zone_champ_saisie"><?php echo form_dropdown    (
      'export_to_other',
      $_SESSION['G']->YorN_pick_list,
      $_SESSION['selected_export_to_other'],
      'style="font-size:16px" class="colorobligatoire"'
    );?>
    <a class="btaide" id="" title="<?php echo $this->lang->line('items_export_to_other');?>"></a>
  </td>
</tr>
    </table>

</td>


</tr>

<tr><td>
<table>
    <tr>


      <td align="" style="font-size:16px;"><?php echo form_label($this->lang->line('items_tax_1'), 'tax_name_1',array('class'=>'required wide')); ?></td>

      <td align="" class="zone_champ_saisie"><?php echo form_input(array (
        'name'    => 'tax_name_1',
        'id'      => 'tax_name_1',
        'size'    => 5,
        'style'       => 'text-align:center; font-size:16px;',
        'class'=> 'colorobligatoire',
        'value'       => isset($_SESSION['item_tax_info[0]']->name) ? $_SESSION['item_tax_info[0]']->name : $this->config->item('default_tax_1_name')
      ));?>
      <a class="btaide" id="" title="<?php echo $this->lang->line('items_tax_1');?>"></a>
    </td>

    <td align="center" class="zone_champ_saisie"><?php echo form_input(array (
      'name'    => 'tax_percent_1',
      'id'      => 'tax_percent_1',
      'size'    => 5,
      'style'       => 'text-align:right; font-size:16px;',
      'class'=> 'colorobligatoire',
      'value'       => isset($_SESSION['item_tax_info[0]']->percent) ? $_SESSION['item_tax_info[0]']->percent : $this->config->item('default_tax_1_rate')
    ));?>
    <td align="right" style="font-size:16px;"><?php echo form_label('%', 'tax_percent_1', array('class'=>'required wide')); ?>

      <a class="btaide" id="" title="<?php echo '%';?>"></a>
    </td>

  </tr>
</table>
              </td>
</tr>
<tr>
    <td>
  <table>
    <tr><td align="center" style="font-size:16px;"><?php echo form_label($this->lang->line('items_DynamicKit').$this->lang->line('common_question'), 'DynamicKit', array('class'=>'required wide')); ?></td>

      <td align="center" class="zone_champ_saisie"><?php echo form_dropdown    (
        'DynamicKit',
        $_SESSION['G']->YorN_pick_list,
        $_SESSION['selected_DynamicKit'],
        'style="font-size:16px" class="colorobligatoire"'
      );?>
      <a class="btaide" id="" title="<?php echo $this->lang->line('items_DynamicKit');?>"></a>
    </td>
    <td align="center" class="zone_champ_saisie"><?php echo form_input(array (
      'name'    => 'kit_reference',
      'id'      => 'kit_reference',
      'style'       => 'text-align:right; font-size:16px;',
      'placeholder'=>$this->lang->line('items_kit_reference'),
      'value'       => $_SESSION['transaction_info']->kit_reference
    ));?>
    <a class="btaide" id="" title="<?php echo $this->lang->line('items_kit_reference');?>"></a>
  </td></tr>
</table>
    </td>


</tr>
                <!-- PARTIE PRIX --->
<tr>
  <td colspan="4" >

      <table class="table_center" style="      border: solid 2px #000000;
    padding: 10px;
    margin-top: 15px;
    margin-bottom: 15px;
    text-align: left;
    font-size: 17px;
    border-spacing: 15px;
    border-collapse: separate;">
<tr>

    <td colspan="2">
      <div id="required_fields_message" style="">
        <?php
        echo $this->lang->line('items_unit_price');
        echo ' = ';
        echo '<span class="c_couleur">';
        echo	$_SESSION['transaction_info']->unit_price;
        echo ' €';
        echo '<span>';
        ?>
      </div>
    </td>

    <td colspan="2">
      <div id="required_fields_message" style="">
        <?php

        echo ' ';
        echo $this->lang->line('items_cost_price');
        echo ' = ';
        echo '<span class="c_couleur">';
        echo	$_SESSION['preferred_supplier_cost_price'];
        echo ' €';
        echo '<span>';
        ?>
      </div>
    </td>



    <td ><div><?php
    echo ' ';
    echo $this->lang->line('items_margin');
    echo ' = ';
    echo '<span class="c_couleur">';
    echo	$_SESSION['percentage_profit']; echo '  %';
    echo '<span>';
    ?>


  </div>
</td>



</tr>
</table></td></tr>



</tbody>



</table>


</fieldset>
<div id="required_fields_message" class="obligatoire">
  <a class="btobligatoire" id="" title="<?php $this->lang->line('common_fields_required_message')?>"></a>
  <?php echo $this->lang->line('common_fields_required_message'); ?>
</div>




</div>

</div>

<div class="txt_milieu">

  <?php
  $target    =  'target="_self"';
  echo anchor          (
    'common_controller/common_exit/','<div class="btretour btlien">'.$this->lang->line('common_reset').'</div>',
    $target
  );
  ?>


  <?php
  echo form_submit               (  array  (
    'name' => 'submit',
    'id'   => 'submit',
    'value'    => $this->lang->line('common_submit'),
    'class'    => 'btsubmit'
  )
);
?>
</div>
<?php
echo form_close();
}
?>

<?php
echo form_close();
?>
</div></div>
</dialog>
